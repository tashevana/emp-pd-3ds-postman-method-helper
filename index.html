<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>3DS Helper</title>
<style>
  iframe { width: 100%; height: 600px; border: 1px solid #ccc; }
  form { display: none; }
</style>
</head>
<body>
  <div id="helperContainer">
    <iframe id="threeDSIframe" name="threeDSIframe"></iframe>
    
    <form id="threeDSForm" target="threeDSIframe" method="POST" novalidate>
      <input type="hidden" name="threeDSMethodData" id="threeDSMethodData" />
      <input type="hidden" name="creq" id="creq" />
      <input type="hidden" name="threeDSSessionData" id="threeDSSessionData" />
    </form>
  </div>

  <script>
    function getQueryParams() {
      const params = {};
      window.location.search.substring(1).split("&").forEach(pair => {
        const [key, value] = pair.split("=");
        if (key) params[decodeURIComponent(key)] = decodeURIComponent(value || "");
      });
      return params;
    }

    (function () {
      const params = getQueryParams();
      const form = document.getElementById("threeDSForm");
      const iframe = document.getElementById("threeDSIframe");

      if (!params.redirect_url || !params.redirect_data || !params.redirect_type) {
        document.body.innerHTML = "<h3>Error: Missing required parameters</h3>";
        return;
      }

      if (params.redirect_type === "3ds_method") {
        form.action = params.redirect_url;
        document.getElementById("threeDSMethodData").value = params.redirect_data;
        form.submit();
        console.log("3DS Method form submitted to", params.redirect_url);
      }

      else if (params.redirect_type === "3ds_challenge") {
        form.action = params.redirect_url;
        document.getElementById("creq").value = params.redirect_data;
        document.getElementById("threeDSSessionData").value = ""; // optional
        form.submit();
        console.log("3DS Challenge form submitted to", params.redirect_url);
      }

      else {
        console.warn("Unknown redirect_type:", params.redirect_type);
      }
    })();
  </script>
</body>
</html>
